const stakingAdd="0x3c1384be3617c691ece2edfd7ba792c94bc65638",dpToken="0xD0D1939fDb393ad57eB3daCEB2b07c60203479D2",stakingAbi=[{inputs:[],name:"claimReward",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"amount",type:"uint256"}],name:"deposit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"contract IBEP20",name:"stakeToken_",type:"address"},{internalType:"contract IBEP20",name:"rewardToken_",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"Deposit",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"previousOwner",type:"address"},{indexed:!0,internalType:"address",name:"newOwner",type:"address"}],name:"OwnershipTransferred",type:"event"},{inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"RewardClaim",type:"event"},{inputs:[{internalType:"uint256",name:"apy_",type:"uint256"}],name:"setApy",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"rewardShare",type:"uint256"}],name:"setMaxRewardShare",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"newOwner",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"withdraw",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"Withdraw",type:"event"},{inputs:[],name:"APY",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"currentTimestamp",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"getMaxAmountDeposit",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"user",type:"address"}],name:"getPendingReward",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"user",type:"address"}],name:"getUserDepositInfo",outputs:[{internalType:"uint256",name:"",type:"uint256"},{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"maxRewardShare",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"rewardToken",outputs:[{internalType:"contract IBEP20",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"stakeToken",outputs:[{internalType:"contract IBEP20",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalStakedTokens",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"usersInfo",outputs:[{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"uint256",name:"startTime",type:"uint256"}],stateMutability:"view",type:"function"}],dpAbi=[{constant:!0,inputs:[],name:"name",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_spender",type:"address"},{name:"_value",type:"uint256"}],name:"approve",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"totalSupply",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_from",type:"address"},{name:"_to",type:"address"},{name:"_value",type:"uint256"}],name:"transferFrom",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"_owner",type:"address"}],name:"balanceOf",outputs:[{name:"balance",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"symbol",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_to",type:"address"},{name:"_value",type:"uint256"}],name:"transfer",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"_owner",type:"address"},{name:"_spender",type:"address"}],name:"allowance",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{payable:!0,stateMutability:"payable",type:"fallback"},{anonymous:!1,inputs:[{indexed:!0,name:"owner",type:"address"},{indexed:!0,name:"spender",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Transfer",type:"event"}];var stakingContract=void 0,tokenContract=void 0,maxAmountDeposit=0;async function onInit(){isConnected&&(getContract(),await getStakingInfo(),hideIndicator())}function onAccChanged(){onInit()}function getContract(){if(null==stakingContract||null==stakingContract){let t=getCurrentWeb3();stakingContract=new t.eth.Contract(stakingAbi,stakingAdd),tokenContract=new t.eth.Contract(dpAbi,dpToken)}}async function getStakingInfo(){let t=getAcc();var e=await stakingContract.methods.totalStakedTokens().call({from:t}),n=await stakingContract.methods.APY().call({from:t}),a=await stakingContract.methods.maxRewardShare().call({from:t}),i=await stakingContract.methods.getMaxAmountDeposit().call({from:t}),s=await stakingContract.methods.getPendingReward(t).call({from:t}),o=await tokenContract.methods.balanceOf(t).call({from:t}),r=await stakingContract.methods.getUserDepositInfo(t).call({from:t}),u=web3.utils.fromWei(e),p=web3.utils.fromWei(a);maxAmountDeposit=web3.utils.fromWei(i);var d=web3.utils.fromWei(s),m=web3.utils.fromWei(o),c=web3.utils.fromWei(r[0]);$("#walletbalance").text(numberWithCommas(m)+" HNFT"),$("#yourstake").text(numberWithCommas(c)+" HNFT"),$("#yourrewards").text(numberWithCommas(d)+" HNFT"),$("#apy").text(numberWithCommas(n)+"%"),$("#totalstaked").text(numberWithCommas(u)+" HNFT"),$("#totalPrize").text(numberWithCommas(p)+" HNFT"),$("#maxAmountDeposit").text(numberWithCommas(maxAmountDeposit)+" HNFT")}async function deposit(){if(isConnected||await connectmetamask(),!isConnected)return;let t=getAcc();var e=$("#inputamount").val();if(isNumeric(e))if(Number(maxAmountDeposit)<Number(e))showMessage("Max tokens deposit is "+maxAmountDeposit,"danger");else{showIndicator();var n=web3.utils.toWei(e);try{await approve(n);const e=await stakingContract.methods.deposit(n).estimateGas({from:t,gasPrice:web3.utils.toWei("5","gwei")});await stakingContract.methods.deposit(n).send({from:t,gas:e,gasPrice:web3.utils.toWei("5","gwei")}).on("receipt",(function(t){showMessage("Deposit successfully"),getStakingInfo(),hideIndicator()})).on("error",(function(t,e){null!=t?showMessage(t.message,"danger"):showMessage("Error","danger"),hideIndicator()}))}catch(t){showMessage(t.message,"danger"),hideIndicator()}}else showMessage("Price is not numeric","danger")}async function withdraw(){if(isConnected||await connectmetamask(),!isConnected)return;let t=getAcc();showIndicator();try{const e=await stakingContract.methods.withdraw().estimateGas({from:t,gasPrice:web3.utils.toWei("5","gwei")});await stakingContract.methods.withdraw().send({from:t,gas:e,gasPrice:web3.utils.toWei("5","gwei")}).on("receipt",(function(t){showMessage("Withdraw successfully"),getStakingInfo(),hideIndicator()})).on("error",(function(t,e){null!=t?showMessage(t.message,"danger"):showMessage("Error","danger"),hideIndicator()}))}catch(t){showMessage(t.message,"danger"),hideIndicator()}}async function claimRewardToken(){if(isConnected||await connectmetamask(),!isConnected)return;let t=getAcc();showIndicator();try{const e=await stakingContract.methods.claimReward().estimateGas({from:t,gasPrice:web3.utils.toWei("5","gwei")});await stakingContract.methods.claimReward().send({from:t,gas:e,gasPrice:web3.utils.toWei("5","gwei")}).on("receipt",(function(t){showMessage("Claim reward successfully"),getStakingInfo(),hideIndicator()})).on("error",(function(t,e){null!=t?showMessage(t.message,"danger"):showMessage("Error","danger"),hideIndicator()}))}catch(t){showMessage(t.message,"danger"),hideIndicator()}}async function approve(t){let e=getAcc();if(null!=tokenContract){var n=await tokenContract.methods.allowance(e,stakingAdd).call({from:e});if(Number(n)>=Number(t))return;try{const t=await tokenContract.methods.approve(stakingAdd,web3.utils.toWei("30000000")).estimateGas({from:e,gasPrice:web3.utils.toWei("5","gwei")});await tokenContract.methods.approve(stakingAdd,web3.utils.toWei("30000000")).send({from:e,gas:t,gasPrice:web3.utils.toWei("5","gwei")})}catch(t){showMessage(t.message,"danger"),hideIndicator()}}}function numberWithCommas(t){var e=(t=Math.round(1e4*t+Number.EPSILON)/1e4).toString().split(".");return e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),e.join(".")}function isNumeric(t){return"string"==typeof t&&(!isNaN(t)&&!isNaN(parseFloat(t)))}$(document).ready((async function(){$("#depositToken").click((function(){deposit()})),$("#claimRewardToken").click((function(){claimRewardToken()})),$("#withdrawToken").click((function(){withdraw()})),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&($("[id='wallet-connect-trust wallet']").removeClass("disabled"),$("[id='wallet-connect-trust wallet']").click((function(){connectmetamask()}))),await init()}));